<!DOCTYPE html>
<html lang="fr-FR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gestion d&#39;état | Introduction à Vue.js</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Découvrez le framework Vue.js dans cette formation de 2 jours">
    
    <link rel="preload" href="/vuejs-training/assets/css/0.styles.bc0ba21a.css" as="style"><link rel="preload" href="/vuejs-training/assets/js/app.1ac87feb.js" as="script"><link rel="preload" href="/vuejs-training/assets/js/3.9c71ca5a.js" as="script"><link rel="preload" href="/vuejs-training/assets/js/20.46052103.js" as="script"><link rel="prefetch" href="/vuejs-training/assets/js/10.40b6cec4.js"><link rel="prefetch" href="/vuejs-training/assets/js/11.ed8f8aa4.js"><link rel="prefetch" href="/vuejs-training/assets/js/12.587a396a.js"><link rel="prefetch" href="/vuejs-training/assets/js/13.39ef95d5.js"><link rel="prefetch" href="/vuejs-training/assets/js/14.4392fcc5.js"><link rel="prefetch" href="/vuejs-training/assets/js/15.b5bb4985.js"><link rel="prefetch" href="/vuejs-training/assets/js/16.23f8c53b.js"><link rel="prefetch" href="/vuejs-training/assets/js/17.1372593b.js"><link rel="prefetch" href="/vuejs-training/assets/js/18.0206bbdd.js"><link rel="prefetch" href="/vuejs-training/assets/js/19.03f5159e.js"><link rel="prefetch" href="/vuejs-training/assets/js/2.7b4135f7.js"><link rel="prefetch" href="/vuejs-training/assets/js/21.2a1dc9b0.js"><link rel="prefetch" href="/vuejs-training/assets/js/22.509f8821.js"><link rel="prefetch" href="/vuejs-training/assets/js/23.3703f9a3.js"><link rel="prefetch" href="/vuejs-training/assets/js/24.61af4414.js"><link rel="prefetch" href="/vuejs-training/assets/js/25.873be683.js"><link rel="prefetch" href="/vuejs-training/assets/js/26.5beca49b.js"><link rel="prefetch" href="/vuejs-training/assets/js/27.ac1acf86.js"><link rel="prefetch" href="/vuejs-training/assets/js/28.f2e51b80.js"><link rel="prefetch" href="/vuejs-training/assets/js/29.b3b2815b.js"><link rel="prefetch" href="/vuejs-training/assets/js/30.09bea011.js"><link rel="prefetch" href="/vuejs-training/assets/js/31.68cba608.js"><link rel="prefetch" href="/vuejs-training/assets/js/32.7797136c.js"><link rel="prefetch" href="/vuejs-training/assets/js/33.47734303.js"><link rel="prefetch" href="/vuejs-training/assets/js/34.30a311fe.js"><link rel="prefetch" href="/vuejs-training/assets/js/35.0ed18b8d.js"><link rel="prefetch" href="/vuejs-training/assets/js/36.8090ec62.js"><link rel="prefetch" href="/vuejs-training/assets/js/37.2de0af54.js"><link rel="prefetch" href="/vuejs-training/assets/js/38.5dd82804.js"><link rel="prefetch" href="/vuejs-training/assets/js/39.db5e8b56.js"><link rel="prefetch" href="/vuejs-training/assets/js/4.3340eb74.js"><link rel="prefetch" href="/vuejs-training/assets/js/40.79aa6197.js"><link rel="prefetch" href="/vuejs-training/assets/js/41.76a2fbb8.js"><link rel="prefetch" href="/vuejs-training/assets/js/42.76d6f69c.js"><link rel="prefetch" href="/vuejs-training/assets/js/5.acaff3c9.js"><link rel="prefetch" href="/vuejs-training/assets/js/6.69994d5d.js"><link rel="prefetch" href="/vuejs-training/assets/js/7.4d297742.js"><link rel="prefetch" href="/vuejs-training/assets/js/8.9aa2b887.js"><link rel="prefetch" href="/vuejs-training/assets/js/9.69e978a7.js">
    <link rel="stylesheet" href="/vuejs-training/assets/css/0.styles.bc0ba21a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuejs-training/fr/" class="home-link router-link-active"><!----> <span class="site-name">Introduction à Vue.js</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Langue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Langue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuejs-training/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/vuejs-training/fr/etat/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Français
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Langue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Langue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuejs-training/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/vuejs-training/fr/etat/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Français
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/vuejs-training/fr/" aria-current="page" class="sidebar-link">Bienvenue</a></li><li><a href="/vuejs-training/fr/presentation/" class="sidebar-link">Présentation de Vue.js</a></li><li><a href="/vuejs-training/fr/outillage/" class="sidebar-link">Outillage</a></li><li><a href="/vuejs-training/fr/vues/" class="sidebar-link">Vues</a></li><li><a href="/vuejs-training/fr/directives/" class="sidebar-link">Directives</a></li><li><a href="/vuejs-training/fr/composants/" class="sidebar-link">Composants</a></li><li><a href="/vuejs-training/fr/reactivite/" class="sidebar-link">Réactivité</a></li><li><a href="/vuejs-training/fr/etat/" aria-current="page" class="active sidebar-link">Gestion d'état</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuejs-training/fr/etat/#pourquoi-une-solution-de-gestion-d-etat" class="sidebar-link">Pourquoi une solution de gestion d'état ?</a></li><li class="sidebar-sub-header"><a href="/vuejs-training/fr/etat/#donnees-partagees-par-reference" class="sidebar-link">Données partagées par référence</a></li><li class="sidebar-sub-header"><a href="/vuejs-training/fr/etat/#store-et-mutations-controlees" class="sidebar-link">Store et mutations contrôlées</a></li><li class="sidebar-sub-header"><a href="/vuejs-training/fr/etat/#pinia" class="sidebar-link">Pinia</a></li><li class="sidebar-sub-header"><a href="/vuejs-training/fr/etat/#tp-implementer-un-store-pinia" class="sidebar-link">TP : Implémenter un store Pinia</a></li></ul></li><li><a href="/vuejs-training/fr/routage/" class="sidebar-link">Routage</a></li><li><a href="/vuejs-training/fr/http/" class="sidebar-link">Requêtes HTTP</a></li><li><a href="/vuejs-training/fr/tests/" class="sidebar-link">Tests automatisés</a></li><li><a href="/vuejs-training/fr/reutilisabilite/" class="sidebar-link">Réusabilité et composition</a></li><li><a href="/vuejs-training/fr/ecosysteme/" class="sidebar-link">Écosystème de Vue</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="gestion-d-etat"><a href="#gestion-d-etat" class="header-anchor">#</a> Gestion d'état</h1> <p>Nous avons vu dans la section précédente comment communiquaient les composants parents et enfants. Toutefois, à mesure que les applications grandissent et se complexifient, des composants très éloignés dans l'arborescence peuvent être amenées à manipuler les mêmes données. Il devient alors très fastidieux de les faire communiquer entre eux pour travailler sur les mêmes références de données. C'est pourquoi il existe des solutions plus ou moins complexes de gestion d'état, ou <em>state management</em>.</p> <h2 id="pourquoi-une-solution-de-gestion-d-etat"><a href="#pourquoi-une-solution-de-gestion-d-etat" class="header-anchor">#</a> Pourquoi une solution de gestion d'état ?</h2> <p><img src="/vuejs-training/assets/img/intro-state-management_fr.7ab4445e.png" alt="Problème multiple vues avec props partagés"></p> <ul><li>parce que propager une variable en <code>props</code> d'un composant parent aux composants petits-enfants et arrière-petits-enfants devient vite fastidieux</li> <li>pour pouvoir partager de l'information entre différents arbres de composants</li> <li>pour déléguer la gestion de données à un service accessible depuis tous les composants</li> <li>pour pouvoir persister automatiquement les données (en <code>localStorage</code> par ex.)</li> <li>pour historiser les états de l'application, faire des rollbacks ou une fonctionnalité <em>Annuler</em></li> <li>pour aider au débogage, aux logs, au monitoring ou encore à la transmission de rapports d'erreur</li></ul> <h2 id="donnees-partagees-par-reference"><a href="#donnees-partagees-par-reference" class="header-anchor">#</a> Données partagées par référence</h2> <p>La solution la plus simple au problème de gestion d'état est de stocker les données au sein d'un ou plusieurs objets déclarés dans leur propre module. Tous les composants voulant manipuler ces données peuvent alors importer l'objet et modifier son contenu en travaillant sur la même référence.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/** stores/state.js **/</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token literal-property property">loggedIn</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/** LoginForm.vue **/</span>
<span class="token keyword">import</span> state <span class="token keyword">from</span> <span class="token string">&quot;stores/state.js&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span> state <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token string">&quot;John Smith&quot;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>loggedIn <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Notez qu'on a intentionnellement déclaré <code>data</code> comme un objet et non une fonction, afin que les instances du composant utilisent la même référence de données partagées.</p> <p>Cependant, on peut aussi tout à fait mélanger donnés locales et données partagées :</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">sharedState</span><span class="token operator">:</span> state<span class="token punctuation">,</span>
    <span class="token literal-property property">privateState</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <p>Cette solution peut faire l'affaire dans de nombreux cas, mais montre rapidement ses limites au débogage lorsqu'un grand nombre de composants différents interagissent avec les données. En effet, les mutations des objets d'état ne sont tracées nulle part, il est donc difficile de trouver la source d'un bug.</p> <h2 id="store-et-mutations-controlees"><a href="#store-et-mutations-controlees" class="header-anchor">#</a> Store et mutations contrôlées</h2> <p>Un pattern un peu plus avancé est de déclarer un objet magasin (<em>store</em>) qui encapsule l'objet d'état et sert d'interface de contrôle. L'objet d'état n'est pas directement accessible de l'extérieur par référence, mais le store fournit des méthodes pour interagir avec : typiquement un getter/setter. On pourra ensuite ajouter dans ces méthodes des instructions de débogage, monitoring, mesure de performance etc.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/** stores/store.js **/</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> reactive <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;bonjour&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// pas d'export pour l'état</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">get</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">DEBUG_MODE</span><span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;[store] get&quot;</span><span class="token punctuation">,</span> prop<span class="token punctuation">)</span>
    <span class="token keyword">return</span> state<span class="token punctuation">[</span>prop<span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">set</span><span class="token punctuation">(</span>prop<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">DEBUG_MODE</span><span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;[store] set&quot;</span><span class="token punctuation">,</span> prop<span class="token punctuation">)</span>
    state<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> value
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token comment">&lt;!-- MyComponent.vue --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">&quot;@/stores/store.js&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">privateState</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      store
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bye!&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="pinia"><a href="#pinia" class="header-anchor">#</a> Pinia</h2> <p>Une fois que l'on dispose d'un store, on est tenté de l'enrichir de nombreuses fonctionnalités en profitant de la centralisation des mutations d'état. Cela a été un terrain de recherche pour de nombreuses équipes de développement, notamment en dehors de l'écosystème Vue avec par exemple les travaux sur l'architecture <em>Flux</em> par l'équipe de React.</p> <p>La communauté Vue est passé par les mêmes étapes pour arriver à <a href="https://vuex.vuejs.org/" target="_blank" rel="noopener noreferrer">Vuex<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, une proposition pour une solution officielle de gestion d'état avec Vue. Après la sortie de Vue 3 et l'introduction de l'<a href="/fr/reutilisabilite">API de Composition</a>, une nouvelle bibliothèque appelée <a href="https://pinia.vuejs.org/" target="_blank" rel="noopener noreferrer">Pinia<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> a remplacé VueX au titre de recommandation officielle. C'est ce que nous allons utiliser ici.</p> <p>Pinia est l'aboutissement de ce pattern de store centralisé. C'est la solution officielle de gestion d'état fournie par l'équipe de Vue. Pinia ne trouvera pas forcément sa place dans tous les projets Vue, mais c'est un très bon atout dans de grosses applications manipulant beaucoup de données.</p> <p>Pinia fonctionne avec les concepts suivants :</p> <ul><li>l'<strong>état</strong>, qui contient les <em>data</em> du store à un instant T</li> <li>les <strong>actions</strong>, utilisées pour muter l'état du store, équivalent aux <em>méthodes</em> des composants</li> <li>les <strong>getters</strong>, des raccourcis pour accéder aux données du store, équivalent aux <em>computed</em></li></ul> <p>Les changements d'état mettent à jour de façon réactive et automatiques toutes les vues utilisant cet état, peu importe leur niveau dans l'arborescence de composants.</p> <h2 id="tp-implementer-un-store-pinia"><a href="#tp-implementer-un-store-pinia" class="header-anchor">#</a> TP : Implémenter un store Pinia</h2> <ol><li>Installer les dépendances <code>pinia</code> and <code>pinia-plugin-persistedstate</code> qu'on utilisera pour persister l'état du store.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> pinia pinia-plugin-persistedstate
</code></pre></div><ol start="2"><li>Créer un store Pinia en créant un fichier <code>src/stores/session.js</code> avec le contenu suivant :</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;pinia&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> useSession <span class="token operator">=</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token string">'session'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">persist</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token function-variable function">state</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token literal-property property">loggedIn</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">login</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> user <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>loggedIn <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> user
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="3"><li>Déclarez le store dans votre application en complétant le fichier <code>main.js</code> comme ceci :</li></ol> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createPinia <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span>
<span class="token keyword">import</span> piniaPluginPersistedstate <span class="token keyword">from</span> <span class="token string">'pinia-plugin-persistedstate'</span>

<span class="token keyword">const</span> pinia <span class="token operator">=</span> <span class="token function">createPinia</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
pinia<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>piniaPluginPersistedstate<span class="token punctuation">)</span>

<span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>pinia<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre></div><ol start="4"><li>Dans le code de l'application, récupérez la donnée <code>loggedIn</code> depuis le store avec <code>useSession()</code></li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Les fonctions utilitaires <code>mapState</code> et <code>mapActions</code> fournies avec Pinia permettent d'abréger le code en reliant facilement une donnée du store à une propriété calculée d'un composant, ou un getter à une méthode.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useSession <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/stores/session&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mapState<span class="token punctuation">,</span> mapActions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;pinia&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// bind this.loggedIn to useSession().loggedIn</span>
        <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span>useSession<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;loggedIn&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// bind this.login to useSession().login  </span>
        <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span>useSession<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;login&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <ol start="5"><li>Dans LoginForm.vue, lors du submit, vérifier si l'utilisateur a entré l'adresse mail <code>test@test.com</code> et le mot de passe <code>test1234</code>. Si c'est le cas, déclencher l'action <code>login</code> pour le user <code>test</code>.</li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Invoquer une action depuis un composant se fait en l'appelant comme une méthode du store:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token function">useSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
session<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">firstname</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">lastname</span><span class="token operator">:</span> <span class="token string">&quot;Smith&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <ol start="6"><li>Se connecter avec les identifiants cités ci-haut, vérifier que l'on bascule bien sur le formulaire de recherche de films, puis actualiser la page.</li></ol> <p><strong>Question</strong> : pourquoi on ne retourne plus sur le formulaire de login après actualisation ?</p> <ol start="7"><li><p>Si l'utilisateur a entré de mauvaises informations, afficher un message d'erreur sous le bouton de connexion. Pour cela, vous pouvez déclarer une String <code>error</code> dans les <code>data</code> du composant.</p></li> <li><p><strong>Bonus</strong> : Coder une action <code>logout</code> et ajouter dans le composant <code>App</code> un bouton de déconnexion qui invoque cette action. Afficher le nom de l'utilisateur connecté à côté de ce bouton.</p></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vuejs-training/fr/reactivite/" class="prev">
        Réactivité
      </a></span> <span class="next"><a href="/vuejs-training/fr/routage/">
        Routage
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vuejs-training/assets/js/app.1ac87feb.js" defer></script><script src="/vuejs-training/assets/js/3.9c71ca5a.js" defer></script><script src="/vuejs-training/assets/js/20.46052103.js" defer></script>
  </body>
</html>
