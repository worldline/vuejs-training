(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{897:function(t,e,s){"use strict";s.r(e);var n=s(8),a=Object(n.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"tests-automatises"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tests-automatises"}},[t._v("#")]),t._v(" Tests automatisés")]),t._v(" "),e("h2",{attrs:{id:"pourquoi-des-tests-automatises"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pourquoi-des-tests-automatises"}},[t._v("#")]),t._v(" Pourquoi des tests automatisés ?")]),t._v(" "),e("p",[t._v("Les tests automatisés sont une étape essentielle du développement de logiciel, et apportent de nombreux bénéfices :")]),t._v(" "),e("ul",[e("li",[t._v("documenter la façon dont un composant doit se comporter")]),t._v(" "),e("li",[t._v("détecter et corriger les bugs plus tôt et plus efficacement")]),t._v(" "),e("li",[t._v("gagner du temps passé à tester manuellement")]),t._v(" "),e("li",[t._v("favoriser le refactoring en toute quiétude")])]),t._v(" "),e("h2",{attrs:{id:"les-types-de-tests-automatises"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#les-types-de-tests-automatises"}},[t._v("#")]),t._v(" Les types de tests automatisés")]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("Tests unitaires")]),t._v(": ils vérifient que les entrées des fonctions, classes ou composables testés produisent bien les résultats attendus en sortie")]),t._v(" "),e("li",[e("strong",[t._v("Tests composants")]),t._v(": ils vérifient que le composant est bien monté et rendu, que l'utilisateur peut interargir avec et qu'il se comporte comme attendu. Ces tests importent plus de code que pour les tests unitaires et sont plus complexes, ce qui implique qu'ils sont plus longs à exécuter.")]),t._v(" "),e("li",[e("strong",[t._v("Tests end-to-end")]),t._v(": aussi appelés tests bout à bout, ces tests couvrent toute votre stack applicative, permettant de tester des scénarios complexes, du front jusqu'à la base de données, sans aucun mocking.")])]),t._v(" "),e("h2",{attrs:{id:"choix-du-test-runner"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#choix-du-test-runner"}},[t._v("#")]),t._v(" Choix du test runner")]),t._v(" "),e("p",[t._v("Pour faire des tests automatisés, vous avez besoin d'un "),e("strong",[t._v("test runner")]),t._v(" qui s'occupe de lancer les tests et recueillir les résultats. L'équipe de Vue recommande "),e("a",{attrs:{href:"https://vitest.dev/",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("Vitest")]),e("OutboundLink")],1),t._v(" pour les tests unitaires et les tests de composants simples (sans interaction), et "),e("a",{attrs:{href:"https://on.cypress.io/component",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("Cypress")]),e("OutboundLink")],1),t._v(" pour les tests de composants plus complexes et les tests end-to-end.")]),t._v(" "),e("p",[t._v("La différence principale entre ces deux solutions est le temps d'exécution et le contexte d'exécution. Cypress invoque un vrai navigateur pour dérouler ses tests, ce qui permet de repérer des problèmes que Vitest ne peut repérer: problèmes de styles CSS, d'événements du DOM, de requêtes réseau en échec...")]),t._v(" "),e("p",[t._v("Vitest et Cypress sont normalement déjà configurés sur votre projet de TP si vous avez bien suivi les instructions à l'initialisation du projet.")]),t._v(" "),e("p",[t._v("Pour plus d'informations et des choix alternatifs d'outillage, vous référer à la "),e("a",{attrs:{href:"https://vuejs.org/guide/scaling-up/testing.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("documentation officielle"),e("OutboundLink")],1),t._v(".")]),t._v(" "),e("h2",{attrs:{id:"vue-test-utils"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#vue-test-utils"}},[t._v("#")]),t._v(" Vue Test Utils")]),t._v(" "),e("p",[t._v("Pour faciliter l'écriture de tests pour des composants Vue, l'équipe fournit également "),e("a",{attrs:{href:"https://vue-test-utils.vuejs.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vue Test Utils"),e("OutboundLink")],1),t._v(", la bibliothèque officielle d'utilitaires de tests pour Vue.js. Elle est accompagnée d'un "),e("a",{attrs:{href:"https://vue-test-utils.vuejs.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("guide détaillé"),e("OutboundLink")],1),t._v(" pour vous aider à mettre en place vos tests dans des configurations personnalisées.")]),t._v(" "),e("p",[t._v("Cette bibliothèque propose une API pour tester les composants Vue, voici certaines des méthodes les plus utilisées :")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("mount")]),t._v(" : permet de monter le composant sur un DOM pour pouvoir le tester ;")]),t._v(" "),e("li",[e("code",[t._v("shallowMount")]),t._v(" : comme mount mais sans monter les éventuels composants enfants ;")]),t._v(" "),e("li",[e("code",[t._v("createLocalVue")]),t._v(" : crée une instance de Vue dans laquelle ajouter des composants, mixins et/ou plugins.")])]),t._v(" "),e("p",[t._v("La classe "),e("code",[t._v("Wrapper")]),t._v(" représentant votre composant monté propose de nombreuses méthodes comme :")]),t._v(" "),e("ul",[e("li",[e("code",[t._v(".html()")]),t._v(", "),e("code",[t._v(".text()")]),t._v(" : récupère le contenu HTML ou texte")]),t._v(" "),e("li",[e("code",[t._v(".find()")]),t._v(", "),e("code",[t._v(".findAll()")]),t._v(" : rechercher des éléments HTML dans le composant")]),t._v(" "),e("li",[e("code",[t._v(".setData()")]),t._v(", "),e("code",[t._v(".setMethods()")]),t._v(", "),e("code",[t._v(".setProps()")]),t._v(" : modifier les options de votre composant")]),t._v(" "),e("li",[e("code",[t._v(".trigger()")]),t._v(" : propager des évènements")])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("Les méthodes décrites ci-dessus permettent de tester la plupart des cas simples. Pour plus d'informations se référer à la "),e("a",{attrs:{href:"https://vue-test-utils.vuejs.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("documentation officielle"),e("OutboundLink")],1),t._v(".")])]),t._v(" "),e("h2",{attrs:{id:"ecriture-de-tests-avec-vitest-et-vue-test-utils"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ecriture-de-tests-avec-vitest-et-vue-test-utils"}},[t._v("#")]),t._v(" Ecriture de tests avec Vitest et Vue Test Utils")]),t._v(" "),e("p",[t._v("Par défaut, Vitest va lancer tous les tests présents dans les dossiers  "),e("code",[t._v("__tests__")]),t._v(". Par exemple, les tests des composants "),e("code",[t._v("Film")]),t._v(" et "),e("code",[t._v("LoginForm")]),t._v(" seront repérés et exécutés par Vitest ici :")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("-- components\n  |-- Film.vue\n  |-- LoginForm.vue\n  |-- __tests__\n    |-- Film.spec.js\n    |-- LoginForm.spec.js\n")])])]),e("p",[t._v("Voici un exemple basique de test du composant "),e("code",[t._v("LoginForm")]),t._v(":")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" mount "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@vue/test-utils'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" LoginForm "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../LoginForm.vue'")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'render the form and check the title'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" wrapper "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LoginForm"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" title "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" wrapper"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'h1'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("expect")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("title"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("text")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("toBe")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Authentication'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("h2",{attrs:{id:"mocking"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mocking"}},[t._v("#")]),t._v(" Mocking")]),t._v(" "),e("p",[t._v("Le "),e("strong",[t._v("mocking")]),t._v(" consiste à isoler le sujet de test en remplaçant par des simulacres toutes les briques extérieures avec lesquelles il interagit. Ainsi, en cas d'échec du test, on s'assure que le problème vient bien de la fonction testée et non d'un composant externe (réseau, bases de données, lib tierce etc.)")]),t._v(" "),e("p",[t._v("Ci-dessous un exemple illustrant les capacités de mocking de Vitest :")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" test"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vi "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vitest'")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Exemple de mocking d'une fonction locale")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" ApiService "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@/services/api.js'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" FilmService "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@/services/film.js'")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"la recherche de films ne retourne aucun résultat"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("done")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// mock de l'API pour retourner une liste vide")]),t._v("\n    ApiService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("api "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vi"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("fn")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" Promise"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    FilmService"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("search")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"something"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("results")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("expect")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("results"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("toBe")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("done")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("h2",{attrs:{id:"tp-tester-le-composant-film"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tp-tester-le-composant-film"}},[t._v("#")]),t._v(" TP : Tester le composant Film")]),t._v(" "),e("ol",[e("li",[t._v("Créer un fichier de spec "),e("code",[t._v("Film.spec.js")]),t._v(" pour tester votre composant "),e("code",[t._v("Film.vue")]),t._v(".")]),t._v(" "),e("li",[t._v("Dans votre test, monter le composant, ajouter une assertion basique et lancer les tests.")]),t._v(" "),e("li",[t._v("Simuler les valeurs d'un film et vérifier le rendu HTML.")]),t._v(" "),e("li",[e("strong",[t._v("Bonus")]),t._v(" : Tester le composant "),e("code",[t._v("LoginForm.vue")]),t._v(", en mockant les appels externes HTTPS ainsi que les appels au store et au routeur. Tester le cas nominal et d'erreur du login.")])])])}),[],!1,null,null,null);e.default=a.exports}}]);